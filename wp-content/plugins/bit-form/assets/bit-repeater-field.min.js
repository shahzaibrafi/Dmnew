var bit_repeater_field=function(){"use strict";return class{#e;#t;#i;#s;#n;#d=[];#r;#a;#l;#h;#o;#u;#c;#m;#p;#f;#w;#b=1;#y=[];#x=[];#g=!1;#A=["select","country","currency","phone-number","file-up"];constructor(e,t){this.#v(t),this.#e="string"==typeof e?this.#n.querySelector(e):e,this.init()}#v(e){this.#s=e.window||window,this.#n=e.document||document,this.#r=e.fieldKey,this.#a=e.fieldName,this.#l=e.contentId,this.#h=e.defaultRow,this.#u=e.minimumRow,this.#c=e.maximumRow,this.#m=e.showAddBtn,this.#p=e.showAddToEndBtn,this.#o=e.defaultValue}init(){this.#c>0&&this.#c<this.#h&&(this.#h=this.#c),this.#u>0&&this.#u>this.#h&&(this.#h=this.#u),this.#c>0&&this.#c<this.#u&&(this.#u=this.#c),this.#u<1&&(this.#u=1),this.#t=this.#R(this.#E(`.${this.#r}-rpt-wrp`)),this.#i=this.#E(`[name='${this.#a}-repeat-index']`),this.#$(),this.#I(`.${this.#r}-rpt-wrp`).forEach((e=>{this.#T(e,this.#b),this.#F(this.#b),this.#B(this.#b),this.#b+=1})),this.#p&&(this.#f=this.#E(`.${this.#r}-add-to-end-btn-wrp`),this.#w=this.#E(`.${this.#r}-add-to-end-btn`),this.#N(this.#w,"click",(e=>this.#C(e)))),this.#K(),this.#o&&(this.value=this.#o)}#$(){const e=bf_globals[this.#l],t=[],i=[],s=[];this.#I("input[name],select[name],textarea[name]",this.#t).forEach((e=>{const i=e.getAttribute("name");t.push(i.replace("[]",""))}));const{fields:n}=e;new Set(t).forEach((e=>{Object.entries(n).forEach((([t,n])=>{n.fieldName===e&&(s.push(t),-1!==this.#A.indexOf(n.typ)&&i.push({key:t,name:e,type:n.typ}))}))})),e.repeatFields||(e.repeatFields={}),e.repeatFields={...e.repeatFields,[this.#r]:s},this.#x=i}#B(e){e>1&&this.#x.forEach((t=>{bf_globals[this.#l].inits[`${t.key}[${e}]`]=this.#s.getFldInstance(this.#l,t.key,t.type,`.rpt-index-${e} `)}))}#S(e){this.#x.forEach((t=>{delete bf_globals[this.#l].inits[`${t.key}[${e}]`]}))}#T(e,t){const i=e,s=this.#I("input[name],select[name],textarea[name]",i),n=this.#s.bf_globals[this.#l];if(i.classList.add(`rpt-index-${t}`),i.dataset.index=t,this.#k(i,!0),s.forEach((e=>{const i=e.getAttribute("id");i&&e.setAttribute("id",`${i}-rpt-${t}`);const s=e.getAttribute("name");-1!==s.indexOf("[]")?e.setAttribute("name",s.replace("[]",`[${t}][]`)):e.setAttribute("name",`${s}[${t}]`);const d=["checkbox","radio"].includes(e.type)?"input":"blur";n.validateFocusLost&&e.addEventListener(d,(e=>validateForm({input:e.target}))),n.onfieldCondition&&(e.addEventListener("input",(e=>bit_conditionals(e))),observeElm(e,"value",((t,i)=>{t!==i&&bit_conditionals({target:e})})))})),(this.#I("label",i)||[]).forEach((e=>{const i=e.getAttribute("for");e.setAttribute("for",`${i}-rpt-${t}`)})),this.#m){const e=this.#E(`.${this.#r}-rpt-add-btn`,i);e.dataset.index=t,this.#N(e,"click",(e=>this.#W(e)))}const d=this.#E(`.${this.#r}-rpt-rmv-btn`,i);return d.dataset.index=t,this.#N(d,"click",(e=>this.#L(e))),i}#O(e){const t=this.#s.getComputedStyle(e);let i=0;return i="border-box"===t.boxSizing?e.scrollHeight:parseInt(t.paddingTop)+parseInt(t.paddingBottom)+e.scrollHeight+parseInt(t.marginTop)+parseInt(t.marginBottom)+parseInt(t.borderTopWidth)+parseInt(t.borderBottomWidth),i}#k(e,t){let i=this.#O(e);setStyleProperty(e,"height",`${i}px`),t?(e.classList.remove("fld-hide"),i=this.#O(e),setStyleProperty(e,"height",`${i}px`)):(setTimeout((()=>{setStyleProperty(e,"height","0px")}),0),e.classList.add("fld-hide")),setTimeout((()=>{e.style.removeProperty("height"),t||e.remove()}),300)}#W(e){if(e.preventDefault(),this.#c>0&&this.#y.length>=this.#c)return;const{currentTarget:t}=e,i=t.dataset.index,s=t.closest(`.${this.#r}-rpt-wrp`),n=this.#R(this.#t),d=this.#T(n,this.#b);d.classList.add("fld-hide"),this.#F(this.#b,i),s.after(d),this.#k(d,!0),this.#B(this.#b),this.#K(),this.#g||scrollToElm(d),this.#b+=1}#L(e){if(e.preventDefault(),this.#u>=this.#y.length)return;const{currentTarget:t}=e,i=t.dataset.index,s=t.closest(`.${this.#r}-rpt-wrp`);this.#k(s,!1),this.#_(i),this.#S(i),this.#K(),s.previousElementSibling&&!this.#g&&scrollToElm(s.previousElementSibling)}#C(e){if(e.preventDefault(),this.#c>0&&this.#y.length>=this.#c)return;const t=this.#R(this.#t),i=this.#T(t,this.#b);i.classList.add("fld-hide"),this.#F(this.#b),this.#f.before(i),this.#k(i,!0),this.#B(this.#b),this.#K(),this.#b+=1}#F(e,t){if(t){const i=this.#y.indexOf(parseInt(t,10))+1;this.#y.splice(i,0,e)}else this.#y.push(e);this.#i.value=this.#y.join(",")}#_(e){const t=this.#y.indexOf(parseInt(e,10));this.#y.splice(t,1),this.#i.value=this.#y.join(",")}#K(){let e=!1;e=this.#c>0&&this.#y.length>=this.#c,this.#I(`.${this.#r}-rpt-add-btn`).forEach((t=>{t.disabled=e})),this.#w&&(this.#w.disabled=e),e=this.#u>0&&this.#y.length<=this.#u,this.#I(`.${this.#r}-rpt-rmv-btn`).forEach((t=>{t.disabled=e}))}reset(){let e=this.#y.length;if(e!==this.#h){for(this.#g=!0;e<this.#h;){const t=this.#y[this.#y.length-1],i=this.#E(`.${this.#r}-rpt-rmv-btn[data-index="${t}"]`);this.#W({currentTarget:i,preventDefault:()=>{}}),e+=1}for(;e>this.#h;){const t=this.#y[this.#y.length-1];this.#E(`.${this.#r}-rpt-rmv-btn[data-index="${t}"]`).click(),e-=1}this.#g=!1}}#E(e,t){return t?t.querySelector(e):this.#e.querySelector(e)}#I(e,t){return t?t.querySelectorAll(e):this.#e.querySelectorAll(e)}#R(e){return e.cloneNode(!0)}#N(e,t,i){e.addEventListener(t,i),this.#d.push({selector:e,eventType:t,cb:i}),this.value=0}#D(e){try{JSON.parse(e)}catch(e){return!1}return!0}get value(){return this.#i.value}set value(e){if(!e||!this.#D(e))return;const t=JSON.parse(e);if(!t.length)return;const i=t.length;let s=this.#y.length;if(s<i)for(;s<i;){const e=this.#y[this.#y.length-1],t=this.#E(`.${this.#r}-rpt-rmv-btn[data-index="${e}"]`);this.#W({currentTarget:t,preventDefault:()=>{}}),s+=1}const n=this.#s.bf_globals[this.#l],{fields:d}=n;t.forEach(((e,t)=>{const i=this.#y[t],s=this.#E(`.${this.#r}-rpt-wrp[data-index="${i}"]`);Object.entries(e).forEach((([e,t])=>{const r=d[e];if(!r||!t)return;const a=r.typ;let l=`${r.fieldName}[${i}]`;if(this.#A.includes(a)){const s=Array.isArray(t)?t.join(n?.configs?.bf_separator):t;n.inits[`${e}[${i}]`]?n.inits[`${e}[${i}]`].value=s:n.inits[e]&&(n.inits[e].value=s)}else if(["radio","check","image-select"].includes(a)){const i=Array.isArray(t)?t:t?.split(n?.configs?.bf_separator)||[];if(("check"===a||"image-select"===a&&"checkbox"===r.inpType)&&(l+="[]"),this.#I(`input[name="${l}"]`,s).forEach((e=>{if(i.includes(e.value)){e.checked=!0;const t=i.indexOf(e.value);i.splice(t,1)}})),i.length){const t=this.#E(`[data-oopt="${e}"]`,s);if(t){t.checked=!0;const n=this.#E(`.${e}-cw input[data-bf-other-inp]`,s);n&&(n.value=i.join(", "),t.value=i.join(", "),t.dispatchEvent(new Event("input")))}}}else if(t){const e=this.#E(`[name="${l}"]`,s);e&&(e.value=t)}}))}))}}}();
