var I=Object.defineProperty;var w=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable;var k=(t,a,s)=>a in t?I(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,u=(t,a)=>{for(var s in a||(a={}))y.call(a,s)&&k(t,s,a[s]);if(w)for(var s of w(a))g.call(a,s)&&k(t,s,a[s]);return t};import{_ as m,bz as z,$ as R,c as p,d$ as $}from"./main-677.js";const M=(t,a,s,d,o,f,e,i,l,r)=>{let h=u({},s);if(a===0){if(i){const c=u({},l);c[t.target.name]="",r(u({},c))}h[t.target.name]=t.target.value}else h.relatedlists[a-1][t.target.name]=t.target.value;switch(t.target.name){case"module":h=U(a,h,o,d,f,e);break}d(u({},h))},E=(t,a,s,d,o,f,e)=>{var i,l;t&&!((l=(i=s==null?void 0:s.default)==null?void 0:i.relatedlists)!=null&&l[s.module])&&S(o,s,d,f,e),a(t)},U=(t,a,s,d,o,f)=>{var l,r;const e=u({},a),i=t===0?e.module:e.relatedlists[t-1].module;return t===0?(e.actions={},e.field_map=[{formField:"",zohoFormField:""}],e.upload_field_map=[{formField:"",zohoFormField:""}],t&&(e.relatedlists[t-1]={})):(e.relatedlists[t-1].field_map=[{formField:"",zohoFormField:""}],e.relatedlists[t-1].upload_field_map=[{formField:"",zohoFormField:""}],e.relatedlists[t-1].actions={}),(r=(l=e.default)==null?void 0:l.moduleData)!=null&&r[i]?t===0?(e.field_map=n(t,e),Object.keys(e.default.moduleData[i].fileUploadFields).length>0&&(e.upload_field_map=n(t,e,!0))):(e.relatedlists[t-1].field_map=n(t,e),Object.keys(e.default.moduleData[i].fileUploadFields).length>0&&(e.relatedlists[t-1].upload_field_map=n(t,e,!0))):q(t,s,e,d,o,f),e},O=(t,a,s,d,o)=>{d(!0);const f={formID:t,id:a.id,dataCenter:a.dataCenter,clientId:a.clientId,clientSecret:a.clientSecret,tokenDetails:a.tokenDetails};p(f,"bitforms_zbigin_refresh_modules").then(e=>{if(e&&e.success){const i=u({},a);i.default||(i.default={}),e.data.modules&&(i.default.modules=e.data.modules),e.data.tokenDetails&&(i.tokenDetails=e.data.tokenDetails),s(u({},i)),o({show:!0,msg:m("Modules refreshed")})}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?o({show:!0,msg:$(m("Modules refresh failed Cause: %s. please try again"),e.data.data||e.data)}):o({show:!0,msg:m("Modules refresh failed. please try again")});d(!1)}).catch(()=>d(!1))},S=(t,a,s,d,o)=>{if(!a.module)return;d(!0);const f={formID:t,module:a.module,dataCenter:a.dataCenter,clientId:a.clientId,clientSecret:a.clientSecret,tokenDetails:a.tokenDetails};p(f,"bitforms_zbigin_refresh_related_lists").then(e=>{var i;if(e&&e.success){const l=u({},a);e.data.related_modules&&(l.default.relatedlists||(l.default.relatedlists={}),l.default.relatedlists[l.module]=e.data.related_modules),e.data.tokenDetails&&(l.tokenDetails=e.data.tokenDetails),s(u({},l)),o({show:!0,msg:m("RelatedLists refreshed")})}else(i=e==null?void 0:e.data)!=null&&i.data||!e.success&&typeof e.data=="string"?o({show:!0,msg:`${m("RelatedLists refresh failed Cause:")}${e.data.data||e.data}. ${m("please try again")}`}):o({show:!0,msg:m("RelatedLists refresh failed. please try again")});d(!1)}).catch(()=>d(!1))},q=(t,a,s,d,o,f)=>{const e=t===0?s.module:s.relatedlists[t-1].module;if(!e)return;o(!0);const i={formID:a,module:e,dataCenter:s.dataCenter,clientId:s.clientId,clientSecret:s.clientSecret,tokenDetails:s.tokenDetails};p(i,"bitforms_zbigin_refresh_fields").then(l=>{if(l&&l.success){const r=u({},s);l.data.fieldDetails&&(r.default.moduleData||(r.default.moduleData={}),r.default.moduleData[e]=l.data.fieldDetails,t===0?(r.field_map=n(t,r),Object.keys(r.default.moduleData[e].fileUploadFields).length>0&&(r.upload_field_map=n(t,r,!0))):(r.relatedlists[t-1].field_map=n(t,r),Object.keys(r.default.moduleData[e].fileUploadFields).length>0&&(r.relatedlists[t-1].upload_field_map=n(t,r,!0)))),l.data.tokenDetails&&(r.tokenDetails=l.data.tokenDetails),d(u({},r))}else f({show:!0,msg:m("Fields refresh failed. please try again")});o(!1)}).catch(()=>o(!1))},P=(t,a,s,d,o,f)=>{const e=t===0?s.module:s.relatedlists[t-1].module;if(!e)return;o(!0);const i={formID:a,module:e,dataCenter:s.dataCenter,clientId:s.clientId,clientSecret:s.clientSecret,tokenDetails:s.tokenDetails};p(i,"bitforms_zbigin_refresh_tags").then(l=>{if(l&&l.success){const r=u({},s);l.data.tags&&(r.default.moduleData||(r.default.moduleData={}),r.default.moduleData[e].tags=l.data.tags,f({show:!0,msg:m("Tags Refreshed")})),l.data.tokenDetails&&(r.tokenDetails=l.data.tokenDetails),d(u({},r))}else f({show:!0,msg:m("Tags refresh failed. please try again")});o(!1)}).catch(()=>o(!1))},Z=(t,a,s,d,o)=>{d(!0);const f={formID:t,dataCenter:a.dataCenter,clientId:a.clientId,clientSecret:a.clientSecret,tokenDetails:a.tokenDetails};p(f,"bitforms_zbigin_refresh_users").then(e=>{if(e&&e.success){const i=u({},a);e.data.users&&(i.default||(i.default={}),i.default.users=e.data.users,o({show:!0,msg:m("Users Refreshed")})),e.data.tokenDetails&&(i.tokenDetails=e.data.tokenDetails),s(u({},i))}else o({show:!0,msg:m("Users refresh failed. please try again")});d(!1)}).catch(()=>d(!1))},n=(t,a,s)=>{var o,f;const d=t===0?a.module:a.relatedlists[t-1].module;return s?a.default.moduleData[d].requiredFileUploadFields.length>0?(o=a.default.moduleData[d].requiredFileUploadFields)==null?void 0:o.map(e=>({formField:"",zohoFormField:e})):[{formField:"",zohoFormField:""}]:a.default.moduleData[d].required.length>0?(f=a.default.moduleData[d].required)==null?void 0:f.map(e=>({formField:"",zohoFormField:e})):[{formField:"",zohoFormField:""}]},j=t=>{const a=t!=null&&t.field_map?t.field_map.filter(d=>{var o,f,e;return!d.formField&&d.zohoFormField&&((e=(f=(o=t==null?void 0:t.default)==null?void 0:o.moduleData)==null?void 0:f[t.module])==null?void 0:e.required.indexOf(d.zohoFormField))!==-1}):[],s=t.relatedlists.map(d=>d.field_map.filter(o=>!o.formField&&o.zohoFormField));return!(a.length>0||s.find(d=>d.length))},x=(t,a,s,d,o,f)=>{if(!t.dataCenter||!t.clientId||!t.clientSecret){s({dataCenter:t.dataCenter?"":m("Data center cann't be empty"),clientId:t.clientId?"":m("Client ID cann't be empty"),clientSecret:t.clientSecret?"":m("Secret key cann't be empty")});return}const e=z(R);o(!0);const i="ZohoBigin.settings.modules.READ,ZohoBigin.settings.fields.READ,ZohoBigin.settings.tags.READ,ZohoBigin.users.READ,ZohoBigin.modules.ALL",l=`https://accounts.zoho.${t.dataCenter}/oauth/v2/auth?scope=${i}&response_type=code&client_id=${t.clientId}&prompt=Consent&access_type=offline&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(e.zohoRedirectURL)}`,r=window.open(l,"zohoBigin","width=400,height=609,toolbar=off"),h=setInterval(()=>{if(r.closed){clearInterval(h);let c={},D=!1;const F=localStorage.getItem("__bitforms_zohoBigin");if(F&&(D=!0,c=JSON.parse(F),localStorage.removeItem("__bitforms_zohoBigin")),!c.code||c.error||!c||!D){const _=c.error?`Cause: ${c.error}`:"";f({show:!0,msg:`${m("Authorization failed")} ${_}. ${m("please try again")}`}),o(!1)}else{const _=u({},t);_.accountServer=c["accounts-server"],A(c,_,a,d,o,f)}}},500)},A=(t,a,s,d,o,f)=>{const e=z(R),i=u({},t);i.dataCenter=a.dataCenter,i.clientId=a.clientId,i.clientSecret=a.clientSecret,i.redirectURI=encodeURIComponent(e.zohoRedirectURL),p(i,"bitforms_zbigin_generate_token").then(l=>l).then(l=>{if(l&&l.success){const r=u({},a);r.tokenDetails=l.data,s(r),d(!0),f({show:!0,msg:m("Authorized Successfully")})}else l&&l.data&&l.data.data||!l.success&&typeof l.data=="string"?f({show:!0,msg:`${m("Authorization failed Cause:")}${l.data.data||l.data}. ${m("please try again")}`}):f({show:!0,msg:m("Authorization failed. please try again")});o(!1)})};export{P as a,E as b,j as c,O as d,x as e,M as h,Z as r};
