var bit_paypal_field=function(){"use strict";return class{#t="";#e="";#i={namespace:"paypal",payType:"payment",currency:"USD",amount:1,shipping:0,tax:0,style:{label:"paypal",color:"gold",shape:"rect",layout:"vertical"}};#n=null;constructor(t,e){Object.assign(this.#i,e),this.#t="string"==typeof t?document.querySelector(t):t,this.#e=`#form-${this.#r()}`,this.init()}init(){const{namespace:t}=this.#i,e=window[t],i={style:this.#s()};this.#o()&&(i.fundingSource=e.FUNDING[this.#i.style.payBtn]),this.#a()?i.createSubscription=(t,e)=>this.#c(t,e):i.createOrder=(t,e)=>this.#l(t,e),i.onClick=(t,e)=>this.#d(e),i.onApprove=(t,e)=>this.#p(t,e),this.#i.onInit&&(i.onInit=this.#i.onInit),e&&e.Buttons(i).render(this.#t)}#a(){return"subscription"===this.#i.payType}#o(){return"standalone"===this.#i.style.layout}#r(){return this.#i.contentId}#c(t,e){if("undefined"!=typeof validateForm&&!validateForm({form:this.#r()}))throw new Error("form validation is failed!");return e.subscription.create({plan_id:this.#i.planId})}async#d(t){const e=this.#r();try{await isFormValidatedWithoutError(e)}catch(e){return t.reject()}const i=await saveFormProgress(e),n=i?.[e];return n?.success?(n.entry_id&&(this.#n=n.entry_id),t.resolve()):t.reject()}#p(t,e){const i=document.getElementById(`${this.#r()}`);i.classList.add("pos-rel","form-loading"),(this.#a()?e.subscription.get():e.order.capture()).then((t=>{const e=bf_globals[this.#r()],n=document.getElementById(`form-${this.#r()}`),r=this.#r()?.split("_")[1];if(null!=n){this.#n&&(e.entryId=this.#n);const s=bfSelect(`input[name="${this.#i.fieldKey}"]`,n);s?s.value=t.id:setHiddenFld({name:this.#i.fieldKey,value:t.id,type:"text"},n);let o=bfSelect('button[type="submit"]',n);o||(o=document.createElement("button"),o.setAttribute("type","submit"),o.style.display="none",n.append(o)),o.click();const a={formID:r,transactionID:t.id,payment_name:"paypal",payment_type:this.#a()?"subscription":"order",payment_response:t,entry_id:this.#n,fieldKey:this.#i.fieldKey},c=new URL(e?.ajaxURL);c.searchParams.append("_ajax_nonce",e?.nonce),c.searchParams.append("action","bitforms_payment_insert"),fetch(c,{method:"POST",body:JSON.stringify(a)}).then((()=>{i.classList.remove("pos-rel","form-loading"),this.#n=null}))}}))}#u(t,e){return document.querySelector(e)?.querySelector(t)}#h(t){if(t){const e=window.bf_globals[this.#r()].fields[t].fieldName;let i=this.#u(`[name="${e}"]`,this.#e);if(i&&"radio"===i.type&&(i=this.#u(`[name="${e}"]:checked`,this.#e)),i&&i.value)return i.value}return""}#l(t,e){const{currency:i,amount:n,shipping:r,tax:s}=this.#i,o=this.#h(this.#i.amountFld)||n,a=this.#h(this.#i.shippingVal)||r,c=this.#h(this.#i.taxVal)||s,l=1*Number(o).toFixed(2),d=1*Number(a).toFixed(2),p=1*(Number(c)*l/100).toFixed(2),u=1*(l+d+p).toFixed(2),h=this.#r()?.split("_")[1];return e.order.create({purchase_units:[{description:`form-id:${h};entry-id:${this.#n};field-key:${this.#i.fieldKey}`,amount:{currency_code:i,value:u,breakdown:{item_total:{currency_code:i,value:l},shipping:{currency_code:i,value:d},tax_total:{currency_code:i,value:p}}}}]})}#s(){const{label:t,color:e,shape:i,layout:n,height:r}=this.#i.style,s={label:this.#a()?"subscribe":t,color:e,shape:i};return this.#o()||(s.layout=n),void 0!==r&&(s.height=Number(r)),s}destroy(){this.#t.innerHTML=""}reset(){this.destroy(),this.init()}}}();
