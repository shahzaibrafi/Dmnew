var F=Object.defineProperty;var b=Object.getOwnPropertySymbols;var w=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var S=(r,e,s)=>e in r?F(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s,d=(r,e)=>{for(var s in e||(e={}))w.call(e,s)&&S(r,s,e[s]);if(b)for(var s of b(e))k.call(e,s)&&S(r,s,e[s]);return r};import{_ as c,bz as y,$ as v,d as p,c as m,dA as R}from"./main-677.js";const z=(r,e,s,l,n,a,o=0)=>{let t=d({},e);const{name:i}=r.target;switch(r.target.value!==""?t[i]=r.target.value:delete t[i],t[r.target.name]=r.target.value,r.target.name){case"folder":t.folderMap=t.folderMap.slice(0,o),t=$(t,l,s,n,a);break}s(d({},t))},$=(r,e,s,l,n)=>{var o,t;const a=d({},r);return delete a.teamType,a.folder&&!((t=(o=a.default)==null?void 0:o.folders)!=null&&t[a.folder])?A(e,a,s,l,n):a.folder&&a.folder!==a.folderMap[a.folderMap.length-1]&&a.folderMap.push(a.folder),a},M=(r,e,s,l)=>{l(!0);const n={flowID:r!=null?r:null,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails},a=m(n,"bitforms_oneDrive_get_all_folders").then(o=>{if(o&&o.success){const t=d({},e);return t.default||(t.default={}),o.data.oneDriveFoldersList&&(t.default.rootFolders=o.data.oneDriveFoldersList,t.tokenDetails=o.data.tokenDetails),s(t),l(!1),"OneDrive Folders List refreshed successfully"}else return l(!1),"OneDrive Folders List refresh failed. please try again"}).catch(()=>l(!1));p.promise(a,{success:o=>o,error:c("Error Occurred"),loading:c("Loading OneDrive Folders List...")})},A=(r,e,s,l,n,a)=>{const o=a?e.folderMap[a]:e.folder;l(!0);const t={formID:r,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,team:e.team,folder:o,teamType:"teamType"in e?"private":"team"};m(t,"bitforms_oneDrive_get_single_folder").then(i=>{if(i&&i.success){const f=d({},e);i.data.folders?(f.default.folders||(f.default.folders={}),f.default.folders[o]=R(i.data.folders,"folderName"),f.folderMap.includes(o)||f.folderMap.push(o),n({show:!0,msg:c("Sub Folders refreshed")})):n({show:!0,msg:c("No Sub Folder Found")}),i.data.tokenDetails&&(f.tokenDetails=i.data.tokenDetails),s(d({},f))}else n({show:!0,msg:c("Sub Folders refresh failed. please try again")});l(!1)}).catch(()=>l(!1))},U=(r,e,s,l,n)=>{if(!r.clientId||!r.clientSecret){n({clientId:r.clientId?"":c("Client Id can't be empty"),clientSecret:r.clientSecret?"":c("Client Secret can't be empty")});return}l(!0);const a="onedrive.readwrite offline_access Files.ReadWrite.All",o=y(v),t=`https://login.live.com/oauth20_authorize.srf?client_id=${r.clientId}&scope=${a}&access_type=offline&prompt=consent&response_type=code&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(o.oneDriveRedirectURL)}`,i=window.open(t,"oneDrive","width=400,height=609,toolbar=off"),f=setInterval(()=>{if(i.closed){clearInterval(f);let u={},g=!1;const _=localStorage.getItem("__bitforms_oneDrive");if(_&&(g=!0,u=JSON.parse(_),localStorage.removeItem("__bitforms_oneDrive")),!u.code||u.error||!u||!g){const h=u.error?`Cause: ${u.error}`:"";p.error(`${c("Authorization failed")} ${h}. ${c("please try again")}`),l(!1)}else{const h=d({},r);h.accountServer=u["accounts-server"],D(u,h,e,s,l)}}},500)},D=(r,e,s,l,n)=>{const a=d({},r);a.clientId=e.clientId,a.clientSecret=e.clientSecret;const o=y(v);a.redirectURI=o.oneDriveRedirectURL,m(a,"bitforms_oneDrive_authorization").then(t=>{if(t&&t.success){const i=d({},e);i.tokenDetails=t.data,s(i),l(!0),p.success(c("Authorized Successfully"))}else t&&t.data&&t.data.data||!t.success&&typeof t.data=="string"?p.error(`${c("Authorization failed Cause:")}${t.data.data||t.data}. ${c("please try again")}`):p.error(c("Authorization failed. please try again"));n(!1)})};export{A as a,U as b,M as g,z as h};
