var bit_razorpay_field=function(){"use strict";return class{#e=null;#t="";#n={clientId:"",options:{currency:"INR",amount:1,amountType:"fixed",theme:{},modal:{},prefill:{},notes:{}}};#i=null;#o=null;#r=null;constructor(e,t){Object.assign(this.#n,t),this.#o=t.document||document,this.#r=t.window||window,this.#t=`#form-${this.#a()}`,this.#e="string"==typeof e?this.#o.querySelector(e):e,this.init()}init(){this.#s(this.#c(`.${this.#n.fieldKey}-razorpay-btn`),"click",(()=>{this.#d()}))}#c(e,t){return t?this.#o.querySelector(t).querySelector(e):this.#e.querySelector(e)}#s(e,t,n){e.addEventListener(t,n)}#l(e,t,n){e.removeEventListener(t,n)}#y(e){if(e){const t=window.bf_globals[this.#a()].fields[e].fieldName;let n=this.#c(`[name="${t}"]`,this.#t);if(n&&"radio"===n.type&&(n=this.#c(`[name="${t}"]:checked`,this.#t)),n&&n.value)return n.value}return""}#m=e=>{const t=document.getElementById(`${this.#a()}`);t.classList.add("pos-rel","form-loading");const n=document.getElementById(`form-${this.#a()}`),i=this.#a()?.split("_")[1];if(null!=n){const o=bf_globals[this.#a()];this.#i&&(o.entryId=this.#i);const r=bfSelect(`input[name="${this.#n.fieldKey}"]`,n);r?r.value=e.razorpay_payment_id:setHiddenFld({name:this.#n.fieldKey,value:e.razorpay_payment_id,type:"text"},n);let a=bfSelect('button[type="submit"]',n);a||(a=document.createElement("button"),a.setAttribute("type","submit"),a.style.display="none",n.append(a)),a.click();const s={formID:i,fieldKey:this.#n.fieldKey,transactionID:e.razorpay_payment_id,payment_type:"subscription"===this.#n.payType?"subscription":"order",entry_id:this.#i},c=new URL(o?.ajaxURL);c.searchParams.append("_ajax_nonce",o?.nonce),c.searchParams.append("action","bitforms_save_razorpay_details"),fetch(c,{method:"POST",body:JSON.stringify(s)}).then((()=>{t.classList.remove("pos-rel","form-loading"),this.#i=null}))}};async#p(e){const t=bf_globals[this.#a()],n=document.getElementById(`${this.#a()}`);n.classList.add("pos-rel","form-loading");const i=new URL(t?.ajaxURL);i.searchParams.append("_ajax_nonce",t?.nonce),i.searchParams.append("action","bitforms_create_razorpay_order");const o=await fetch(i,{method:"POST",body:JSON.stringify(e)}),r=await o.json();return n.classList.remove("pos-rel","form-loading"),r.data.error||!e.success?"":r.data.id}async#d(){const{currency:e,amount:t,amountType:n,amountFld:i,name:o,description:r,theme:a,prefill:s,modal:c,notes:d}=this.#n.options,{confirm_close:l}=c,{contentId:y}=this.#n;let m=d;"undefined"!=typeof replaceFieldAndSmartValues&&m&&(m=JSON.parse(replaceFieldAndSmartValues(JSON.stringify(m),y))),"undefined"!=typeof bf_modify_razorpay_notes&&(m=bf_modify_razorpay_notes(m));const p=100*Number("dynamic"===n?this.#y(i):t);try{await isFormValidatedWithoutError(y)}catch(e){return!1}const f=await saveFormProgress(y),h=f?.[y];if(!h?.success)return;h.entry_id&&(this.#i=h.entry_id);let u="";if(this.#n.includeOrderId)if(this.#n.newOrderId||""===this.#n.orderIdFld){const t={payIntegID:this.#n.payIntegID,currency:e,amount:p,notes:m};u=await this.#p(t)}else u=this.#y(this.#n.orderIdFld);const g={key:this.#n.clientId,currency:e,amount:p,name:o,description:r,theme:a,order_id:u,prefill:{name:this.#y(s.prefillNameFld),email:this.#y(s.prefillEmailFld),contact:this.#y(s.prefillContactFld)},notes:m,modal:{backdropclose:!1,escape:!1,confirm_close:l},handler:async e=>this.#m(e)};new this.#r.Razorpay(g).open()}#a(){return this.#n.contentId}destroy(){this.#l(this.#c(`.${this.#n.fieldKey}-razorpay-btn`),"click",(()=>{this.#d()}))}reset(){this.destroy(),this.init()}}}();
