var R=Object.defineProperty,P=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var _=(a,t,i)=>t in a?R(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i,f=(a,t)=>{for(var i in t||(t={}))E.call(t,i)&&_(a,i,t[i]);if(w)for(var i of w(t))q.call(t,i)&&_(a,i,t[i]);return a},z=(a,t)=>P(a,A(t));import{_ as n,bz as $,$ as y,c as m,d$ as O}from"./main-677.js";const N=(a,t,i,o,d,r,e,s,l)=>{let c=f({},t);if(e){const p=f({},s);p[a.target.name]="",l(f({},p))}switch(c[a.target.name]=a.target.value,a.target.name){case"orgId":c=U(c,o,i,d,r);break;case"department":c=b(c,o,i,d,r);break}i(f({},c))},U=(a,t,i,o,d)=>{var e,s,l,c;const r=f({},a);return r.department="",r.field_map=[{formField:"",zohoFormField:""}],r.actions={},(s=(e=r==null?void 0:r.default)==null?void 0:e.departments)!=null&&s[r.orgId]?((c=(l=r==null?void 0:r.default)==null?void 0:l.departments)==null?void 0:c[r.orgId].length)===1&&(r.field_map=D(r)):v(t,r,i,o,d),r},b=(a,t,i,o,d)=>{var e,s;const r=f({},a);return r.field_map=[{formField:"",zohoFormField:""}],r.actions={},(s=(e=r==null?void 0:r.default)==null?void 0:e.fields)!=null&&s[r.orgId]?r.field_map=D(r):F(t,r,i,o,d),r},H=(a,t,i,o,d)=>{o(!0);const r={formID:a,id:t.id,dataCenter:t.dataCenter,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails};m(r,"bitforms_zdesk_refresh_organizations").then(e=>{if(e&&e.success){const s=f({},t);e.data.organizations&&(s.default=z(f({},s.default),{organizations:e.data.organizations})),e.data.tokenDetails&&(s.tokenDetails=e.data.tokenDetails),d({show:!0,msg:n("Portals refreshed")}),i(f({},s))}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?d({show:!0,msg:`${n("Portals refresh failed Cause:")}${e.data.data||e.data}. ${n("please try again")}`}):d({show:!0,msg:n("Portals refresh failed. please try again")});o(!1)}).catch(()=>o(!1))},v=(a,t,i,o,d)=>{o(!0);const r={formID:a,id:t.id,dataCenter:t.dataCenter,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails,orgId:t.orgId};m(r,"bitforms_zdesk_refresh_departments").then(e=>{var s,l;if(e&&e.success){const c=f({},t);c.default.departments||(c.default.departments={}),e.data.departments&&(c.default.departments[c.orgId]=e.data.departments),e.data.departments.length===1&&(c.department=e.data.departments[c.orgId][0].departmentName,!((l=(s=c.default)==null?void 0:s.fields)!=null&&l[c.orgId])&&F(a,c,i,o,d)),e.data.tokenDetails&&(c.tokenDetails=e.data.tokenDetails),d({show:!0,msg:n("Departments refreshed")}),i(f({},c))}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?d({show:!0,msg:O(n("Departments refresh failed Cause: %s. please try again"),e.data.data||e.data)}):d({show:!0,msg:n("Departments refresh failed. please try again")});o(!1)}).catch(()=>o(!1))},F=(a,t,i,o,d)=>{o(!0);const r={formID:a,dataCenter:t.dataCenter,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails,orgId:t.orgId};m(r,"bitforms_zdesk_refresh_fields").then(e=>{if(e&&e.success){const s=f({},t);e.data.fields?(s.default.fields||(s.default.fields={}),s.default.fields[s.orgId]=f({},e.data),s.field_map=D(s),e.data.tokenDetails&&(s.tokenDetails=e.data.tokenDetails),d({show:!0,msg:n("Fields refreshed")})):d({show:!0,msg:`${n("Fields refresh failed Cause:")}${e.data.data||e.data}. ${n("please try again")}`}),e.data.tokenDetails&&(s.tokenDetails=e.data.tokenDetails),i(f({},s))}else d({show:!0,msg:n("Fields refresh failed. please try again")});o(!1)}).catch(()=>o(!1))},J=(a,t,i,o,d)=>{o(!0);const r={formID:a,id:t.id,dataCenter:t.dataCenter,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails,orgId:t.orgId};m(r,"bitforms_zdesk_refresh_owners").then(e=>{if(e&&e.success){const s=f({},t);s.default.owners||(s.default.owners={}),e.data.owners&&(s.default.owners[s.orgId]=e.data.owners),e.data.tokenDetails&&(s.tokenDetails=e.data.tokenDetails),d({show:!0,msg:n("Owners refreshed")}),i(f({},s))}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?d({show:!0,msg:`${n("Owners refresh failed Cause:")}${e.data.data||e.data}. ${n("please try again")}`}):d({show:!0,msg:n("Owners refresh failed. please try again")});o(!1)}).catch(()=>o(!1))},W=(a,t,i,o,d)=>{o(!0);const r={formID:a,id:t.id,dataCenter:t.dataCenter,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails,orgId:t.orgId,departmentId:t.department};m(r,"bitforms_zdesk_refresh_products").then(e=>{if(e&&e.success){const s=f({},t);s.default.products||(s.default.products={}),e.data.products&&(s.default.products[s.department]=e.data.products),e.data.tokenDetails&&(s.tokenDetails=e.data.tokenDetails),d({show:!0,msg:n("Products refreshed")}),i(f({},s))}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?d({show:!0,msg:`${n("Products refresh failed Cause:")}${e.data.data||e.data}. ${n("please try again")}`}):d({show:!0,msg:n("Products refresh failed. please try again")});o(!1)}).catch(()=>o(!1))},D=a=>{var t;return a.default.fields[a.orgId].required.length>0?(t=a.default.fields[a.orgId].required)==null?void 0:t.map(i=>({formField:"",zohoFormField:i})):[{formField:"",zohoFormField:""}]},Z=a=>!((a!=null&&a.field_map?a.field_map.filter(i=>{var o,d,r;return!i.formField&&i.zohoFormField&&((r=(d=(o=a==null?void 0:a.default)==null?void 0:o.fields)==null?void 0:d[a.orgId])==null?void 0:r.required.indexOf(i.zohoFormField))!==-1}):[]).length>0),j=(a,t,i,o,d,r)=>{if(!a.dataCenter||!a.clientId||!a.clientSecret){i({dataCenter:a.dataCenter?"":n("Data center cann't be empty"),clientId:a.clientId?"":n("Client ID cann't be empty"),clientSecret:a.clientSecret?"":n("Secret key cann't be empty")});return}const e=$(y);d(!0);const s="Desk.settings.READ,Desk.basic.READ,Desk.search.READ,Desk.contacts.READ,Desk.contacts.CREATE,Desk.contacts.UPDATE,Desk.tickets.CREATE,Desk.tickets.UPDATE",l=`https://accounts.zoho.${a.dataCenter}/oauth/v2/auth?scope=${s}&response_type=code&client_id=${a.clientId}&prompt=Consent&access_type=offline&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(e.zohoRedirectURL)}`,c=window.open(l,"zohoDesk","width=400,height=609,toolbar=off"),p=setInterval(()=>{if(c.closed){clearInterval(p);let h={},I=!1;const u=localStorage.getItem("__bitforms_zohoDesk");if(u&&(I=!0,h=JSON.parse(u),localStorage.removeItem("__bitforms_zohoDesk")),!h.code||h.error||!h||!I){const g=h.error?`Cause: ${h.error}`:"";r({show:!0,msg:`${n("Authorization failed")} ${g}. ${n("please try again")}`}),d(!1)}else{const g=f({},a);g.accountServer=h["accounts-server"],S(h,g,t,o,d,r)}}},500)},S=(a,t,i,o,d,r)=>{const e=$(y),s=f({},a);s.dataCenter=t.dataCenter,s.clientId=t.clientId,s.clientSecret=t.clientSecret,s.redirectURI=encodeURIComponent(e.zohoRedirectURL),m(s,"bitforms_zdesk_generate_token").then(l=>l).then(l=>{if(l&&l.success){const c=f({},t);c.tokenDetails=l.data,i(c),o(!0),r({show:!0,msg:n("Authorized Successfully")})}else l&&l.data&&l.data.data||!l.success&&typeof l.data=="string"?r({show:!0,msg:`${n("Authorization failed Cause:")}${l.data.data||l.data}. ${n("please try again")}`}):r({show:!0,msg:n("Authorization failed. please try again")});d(!1)})};export{W as a,H as b,Z as c,v as d,F as e,j as f,N as h,J as r};
